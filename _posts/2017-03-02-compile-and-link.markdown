---
layout: post
title:  "compile and link"
date:   2017-03-02 13:52:54 +0800
categories: jekyll update
---

###  动态库和静态库 
* 动态库  
  + 优点：程序复用，可以导出函数，被多个程序复用，函数的实现被修改后，使用该库的程序无需重新编译和链接。  
  + 缺点：DLL Hell 由于dll升级导致的无法正常使用。

* 静态库  
  + 缺点：浪费磁盘和内存。

###  Linux库文件的搜索路径
  本文主要讲解linux库文件,主要包含LD_LIBRARY_PATH 中指明库的搜索路径、在 /etc/ld.so.conf 文件中添加库的搜索路径等方面。
  AD：
  linux有很多值得学习的地方，这里我们主要介绍linux库文件，经过搜集和整理linux库文件材料，在这里拿出来和大家分享一下，希望大家看后会有不少收获。

  linux库文件在连接（静态库和共享库）和运行（仅限于使用共享库的程序）时被使用，其搜索路径是在系统中进行设置的。

  一般 Linux 系统把 /lib 和 /usr/lib 两个目录作为默认的库搜索路径，所以使用这两个目录中的库时不需要进行设置搜索路径即可直接使用。对于处于默认库搜索路径之外的库，需要将库的位置添加到库的搜索路径之中。

  设置linux库文件的搜索路径有下列两种方式，可任选其一使用：
  在环境变量 LD_LIBRARY_PATH 中指明库的搜索路径。
  在 /etc/ld.so.conf 文件中添加库的搜索路径。
  将自己可能存放库文件的路径都加入到/etc/ld.so.conf中是明智的选择
  添加方法也极其简单，将linux库文件的绝对路径直接写进去就OK了，一行一个。

  例如：
  /usr/X11R6/lib
  /usr/local/lib
  /opt/lib
  需要注意的是：第二种搜索路径的设置方式对于程序连接时的库（包括共享库和静态库）的定位已经足够了，但是对于使用了共享库的程序的执行还是不够的。这是因为为了加快程序执行时对共享库的定位速度，避免使用搜索路径查找共享库的低效率，所以是直接读取库列表文件 /etc/ld.so.cache 从中进行搜索的。/

  etc/ld.so.cache 是一个非文本的数据文件，不能直接编辑，它是根据 /etc/ld.so.conf 中设置的搜索路径由 /sbin/ldconfig 命令将这些搜索路径下的共享库文件集中在一起而生成的（ldconfig 命令要以 root 权限执行）。因此，为了保证程序执行时对库的定位，在 /etc/ld.so.conf 中进行了库搜索路径的设置之后，还必须要运行 /sbin/ldconfig 命令更新 /etc/ld.so.cache 文件之后才可以。

  ldconfig ,简单的说，它的作用就是将/etc/ld.so.conf列出的路径下的linux库文件缓存到/etc/ld.so.cache 以供使用。因此当安装完一些库文件，(例如刚安装好glib)，或者修改ld.so.conf增加新的库路径后，需要运行一下 /sbin/ldconfig使所有的库文件都被缓存到ld.so.cache中，如果没做，即使库文件明明就在/usr/lib下的，也是不会被使用的，结果编译过程中抱错，缺少xxx库，去查看发现明明就在那放着，搞的想大骂computer蠢猪一个。

  在程序连接时，对于linux库文件（静态库和共享库）的搜索路径，除了上面的设置方式之外，还可以通过 -L 参数显式指定。因为用 -L 设置的路径将被优先搜索，所以在连接的时候通常都会以这种方式直接指定要连接的库的路径。

  前面已经说明过了，库搜索路径的设置有两种方式：在环境变量 LD_LIBRARY_PATH 中设置以及在 /etc/ld.so.conf 文件中设置。其中，第二种设置方式需要 root 权限，以改变 /etc/ld.so.conf 文件并执行 /sbin/ldconfig 命令。而且，当系统重新启动后，所有的基于 GTK2 的程序在运行时都将使用新安装的 GTK+ 库。不幸的是，由于 GTK+ 版本的改变，这有时会给应用程序带来兼容性的问题，造成某些程序运行不正常。为了避免出现上面的这些情况，在 GTK+ 及其依赖库的安装过程中对于linux库的搜索路径的设置将采用第一种方式进行。

  这种设置方式不需要 root 权限，设置也简单：
  $ export LD_LIBRARY_PATH=/opt/gtk/lib:$LD_LIBRARY_PATH
  可以用下面的命令查看 LD_LIBRAY_PATH 的设置内容：
  $ echo $LD_LIBRARY_PATH
  至此，库的两种设置就完成了。

